{% extends "base.html" %}
{% load static %}

{% block title %}MuebleStock{% endblock %}

{% block nav_items %}
  <li class="nav-item"><a class="nav-link" href="#busqueda-muebles">Buscar Muebles</a></li>
  <li class="nav-item"><a class="nav-link" href="#contacto">Contacto</a></li>
  <li class="nav-item"><a class="nav-link" href="#catalogo-muebles">Catálogo</a></li>
  <li class="nav-item"><a class="nav-link" href="#sobre-nosotros">Sobre Nosotros</a></li>
  <li class="nav-item"><a class="nav-link" href="#contacto">Contacto</a></li>
{% endblock %}

{% block content %}

<section id="catalogo-muebles" class="my-4">
  <div class="container-fluid">
    <div class="row">
      <!-- Panel lateral izquierdo -->
            <div class="col-12 col-md-2 mt-5">
              <br>
              <BR></BR>
              <BR></BR>
              <BR></BR>
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-dark text-white text-center">
                            <strong>Conócenos</strong>
                        </div>
                        <div class="card-body small">
                            <p>Este es un catálogo de nuestros muebles en stock.</p>
                        </div>
                    </div>

                    <div id="ordenar-productos" class="my-4">
                            <div class="card-header bg-secondary text-white text-center">
                                <strong>Ordenar por</strong>
                            </div>
                            <div class="container">
                                <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i>   </span>
                            <!-- Selector de ordenamiento -->
                            <form method="get" action="{% url 'home' %}">
                                <div class="input-group input-group-lg mb-3">
                                    <span class="input-group-text bg-white border-end-0">
                                    <i class="bi bi-filter"></i>
                                    </span>
                                    <select class="form-select" name="orden" aria-label="Ordenar por">
                                    <option value="">Ordenar por...</option>
                                    <option value="nombre_asc" {% if orden == 'nombre_asc' %}selected{% endif %}>Nombre A-Z</option>
                                    <option value="nombre_desc" {% if orden == 'nombre_desc' %}selected{% endif %}>Nombre Z-A</option>
                                    <option value="precio_menor" {% if orden == 'precio_menor' %}selected{% endif %}>Menor precio</option>
                                    <option value="precio_mayor" {% if orden == 'precio_mayor' %}selected{% endif %}>Mayor precio</option>
                                    <option value="stock" {% if orden == 'stock' %}selected{% endif %}>Más stock</option>
                                    </select>
                                    <button class="btn btn-primary" type="submit">Aplicar</button>
                                </div>
                              </form>
                            </div>
                    </div>

                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-secondary text-white text-center">
                            <strong>Categorías</strong>
                        </div>
                        <form method="get" action="{% url 'home' %}">
                          <div class="input-group input-group-lg">
                            <span class="input-group-text bg-white border-end-0">
                              <i class="bi bi-search"></i>
                            </span>
                            <select class="form-select" name="categoria" aria-label="Filtrar por categoría">
                              <option value="">Todas las categorías</option>
                              {% for cat in categorias %}
                                <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == categoria_id %}selected{% endif %}>
                                  {{ cat.nombre }}
                                </option>
                              {% endfor %}
                            </select>
                            <button class="btn btn-primary" type="submit">Buscar</button>
                          </div>
                        </form>
                    </div>
            </div>

            <!-- Contenido principal a la derecha -->
            <div class="col-12 col-md-7">
                    <!-- Sección de búsqueda -->
                    <section id="busqueda-muebles" class="mt-3">
                      <div class="d-flex justify-content-center my-4">
                            <h1 class="d-inline-flex align-items-center gap-2 bg-success text-white px-4 py-3 rounded-3 shadow-sm fs-4">
                            <i class="bi bi-search fs-3"></i>
                            <span>Buscar Producto</span>
                            </h1>
                      </div>

                      <div class="card mx-auto" style="max-width: 800px;">
                        <form method="get" action="{% url 'home' %}">
                          <div class="input-group input-group-lg">
                            <span class="input-group-text bg-white border-end-0">
                              <i class="bi bi-search"></i>
                            </span>
                            <input 
                              type="text" 
                              class="form-control border-start-0" 
                              id="busqueda" 
                              name="q" 
                              value="{{ query }}" 
                              placeholder="Buscar muebles... (ej: mesa, silla, sofá)" 
                              aria-label="Buscar muebles">
                            <button class="btn btn-primary" type="submit">Buscar</button>
                          </div>
                        </form>
                      </div>
                    </section>

                    <!-- Catálogo de productos -->
                    <div class="py-4">
                        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
                            {% for item in items %}
                            <div class="col">
                                <div class="card h-100 border rounded-2 shadow-sm">
                                    <img src="{{ item.imagen.url }}" class="card-img-top img-fluid p-2" style="height: 180px; object-fit: contain;" alt="{{ item.nombre }}">
                                    <div class="card-body">
                                    <h5 class="card-title text-primary fw-bold">{{ item.nombre }}</h5>
                                    <ul class="list-unstyled small fs-4">
                                        <li><i class="bi bi-cash-coin text-success"></i> <strong>Precio:</strong> <span class="badge bg-success">${{ item.precio|floatformat:2 }}</span></li>
                                        <li><i class="bi bi-tags"></i> <strong>Categoría:</strong> {{ item.categoria.nombre }}</li>
                                        <li><i class="bi bi-truck"></i> <strong>Proveedor:</strong> {{ item.proveedor.nombre }}</li>
                                        <li><i class="bi bi-box-seam"></i> <strong>Stock:</strong> {{ item.stock }} unidades</li>
                                        <li><i class="bi bi-info-circle"></i> <strong>Descripción:</strong> {{ item.descripcion|default:"Sin descripción" }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                            {% endfor %}
                    </div>
            </div>
    </div>
  </div>
</section>

{% endblock %}


{% block extra_js %}
<!-- Botón volver arriba (HTML, fuera del <script>) -->
<a id="btn-top" href="#busqueda-muebles" class="btn btn-danger btn-lg rounded-circle position-fixed" style="bottom: 20px; right: 20px; display: none;">
    <i class="bi bi-arrow-up"></i>
</a>

<script>
  // Scroll suave para links del navbar
  document.querySelectorAll('a.nav-link').forEach(anchor => {
    anchor.addEventListener('click', function(e){
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      target.scrollIntoView({ behavior: 'smooth' });
    });
  });

  // Mostrar u ocultar el botón de volver arriba
  const btnTop = document.getElementById('btn-top');
  window.addEventListener('scroll', () => {
    if (window.scrollY > 200) {
      btnTop.style.display = 'block';
    } else {
      btnTop.style.display = 'none';
    }
  });
</script>
{% endblock %}
